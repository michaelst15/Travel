{"ast":null,"code":"import _regeneratorRuntime from\"D:/Travel/Travel/backend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/Travel/Travel/backend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import User from\"../model/regis.js\";import jwt from'jsonwebtoken';import bcrypt from'bcryptjs';export var login=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(req,res,next){var jwtKey,user,token;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:jwtKey=\"Secret_Key\";_context.prev=1;_context.next=4;return User.findOne({where:{email:req.body.email,password:req.body.password}});case 4:user=_context.sent;if(user){token=jwt.sign({email:user.email},jwtKey,{algorithm:\"HS256\",expiresIn:300});if(bcrypt.compare(req.body.password,user.password)){res.status(200).send({id:user.id,nama:user.nama,email:user.email,password:user.password,token:token});}}else{res.status(404).json({message:'Email atau password salah'});}_context.next=12;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);console.log(_context.t0);res.status(500).json({message:'Internal server error'});case 12:case\"end\":return _context.stop();}},_callee,null,[[1,8]]);}));return function login(_x,_x2,_x3){return _ref.apply(this,arguments);};}();export var Register=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(req,res,next){var _req$body,nama,email,password,alreadyUser,newUser,saveUser;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_req$body=req.body,nama=_req$body.nama,email=_req$body.email,password=_req$body.password;_context2.next=3;return User.findOne({where:{email:email}}).catch(function(err){console.log(\"error\",err);});case 3:alreadyUser=_context2.sent;if(!alreadyUser){_context2.next=6;break;}return _context2.abrupt(\"return\",res.status(400).json({message:\"Email sudah dipakai\"}));case 6:newUser=new User({nama:nama,email:email,password:password});_context2.next=9;return newUser.save().catch(function(err){console.log(\"error\",err);res.status(500).json({error:\"Tidak dapat mendaftar pengguna\"});});case 9:saveUser=_context2.sent;if(saveUser){res.json({message:\"Registrasi berhasil\"});}case 11:case\"end\":return _context2.stop();}},_callee2);}));return function Register(_x4,_x5,_x6){return _ref2.apply(this,arguments);};}();export var logout=function logout(req,res){res.clearCookie('token');return res.json({message:'logout success'});};","map":{"version":3,"names":["User","jwt","bcrypt","login","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","req","res","next","jwtKey","user","token","wrap","_callee$","_context","prev","findOne","where","email","body","password","sent","sign","algorithm","expiresIn","compare","status","send","id","nama","json","message","t0","console","log","stop","_x","_x2","_x3","apply","arguments","Register","_ref2","_callee2","_req$body","alreadyUser","newUser","saveUser","_callee2$","_context2","catch","err","abrupt","save","error","_x4","_x5","_x6","logout","clearCookie"],"sources":["D:/Travel/Travel/backend/src/controller/UserController.js"],"sourcesContent":["import User from \"../model/regis.js\";\r\nimport jwt from 'jsonwebtoken';\r\nimport bcrypt from 'bcryptjs';\r\n\r\n\r\nexport const login = async (req, res, next) => {\r\n\r\n  const jwtKey = \"Secret_Key\";\r\n\r\n    try {\r\n      const user = await User.findOne({\r\n        where: {\r\n          email: req.body.email,\r\n          password: req.body.password\r\n        }\r\n      });\r\n  \r\n      if (user) {\r\n\r\n        let token = jwt.sign({ email: user.email }, \r\n            jwtKey, {\r\n              algorithm: \"HS256\",\r\n              expiresIn: 300,\r\n            } \r\n          )\r\n\r\n        if (bcrypt.compare(req.body.password, user.password)) {\r\n          res.status(200).send({\r\n            id: user.id,\r\n            nama: user.nama,\r\n            email: user.email,\r\n            password: user.password,\r\n            token,\r\n          });\r\n        }\r\n      } else {\r\n        res.status(404).json({\r\n          message: 'Email atau password salah'\r\n        });\r\n      }\r\n    } catch (err) {\r\n      console.log(err);\r\n      res.status(500).json({\r\n        message: 'Internal server error'\r\n      });\r\n    }\r\n  };\r\n\r\nexport const Register = async(req, res, next) => {\r\n         const { nama, email, password } = req.body;\r\n         const alreadyUser = await User.findOne({ where: { email } })\r\n         .catch((err) => {\r\n            console.log(\"error\", err);\r\n         });\r\n\r\n        if(alreadyUser) {\r\n            return res.status(400).json({ message: \"Email sudah dipakai\" })\r\n        }\r\n\r\n        const newUser = new User({ nama, email, password });\r\n        const saveUser = await newUser.save()\r\n        .catch((err) => {\r\n            console.log(\"error\", err);\r\n            res.status(500).json({ error: \"Tidak dapat mendaftar pengguna\" })\r\n        })\r\n\r\n        if(saveUser) {\r\n            res.json({ message: \"Registrasi berhasil\" })\r\n        }\r\n\r\n}\r\n\r\nexport const logout = (req, res) => {\r\n  res.clearCookie('token');\r\n  return res.json({ message: 'logout success' });\r\n}\r\n\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}